var Utilities,IView;(function(n,t){typeof exports=="object"&&typeof module!="undefined"?t():typeof define=="function"&&define.amd?define(t):t()})(this,function(){"use strict";function f(n){var t=this.constructor;return this.then(function(i){return t.resolve(n()).then(function(){return i})},function(i){return t.resolve(n()).then(function(){return t.reject(i)})})}function h(){}function c(n,t){return function(){n.apply(t,arguments)}}function n(t){if(!(this instanceof n))throw new TypeError("Promises must be constructed via new");if(typeof t!="function")throw new TypeError("not a function");this._state=0;this._handled=!1;this._value=undefined;this._deferreds=[];o(t,this)}function e(i,u){while(i._state===3)i=i._value;if(i._state===0){i._deferreds.push(u);return}i._handled=!0;n._immediateFn(function(){var n=i._state===1?u.onFulfilled:u.onRejected,f;if(n===null){(i._state===1?r:t)(u.promise,i._value);return}try{f=n(i._value)}catch(e){t(u.promise,e);return}r(u.promise,f)})}function r(i,r){try{if(r===i)throw new TypeError("A promise cannot be resolved with itself.");if(r&&(typeof r=="object"||typeof r=="function")){var f=r.then;if(r instanceof n){i._state=3;i._value=r;u(i);return}if(typeof f=="function"){o(c(f,r),i);return}}i._state=1;i._value=r;u(i)}catch(e){t(i,e)}}function t(n,t){n._state=2;n._value=t;u(n)}function u(t){t._state===2&&t._deferreds.length===0&&n._immediateFn(function(){t._handled||n._unhandledRejectionFn(t._value)});for(var i=0,r=t._deferreds.length;i<r;i++)e(t,t._deferreds[i]);t._deferreds=null}function l(n,t,i){this.onFulfilled=typeof n=="function"?n:null;this.onRejected=typeof t=="function"?t:null;this.promise=i}function o(n,i){var u=!1;try{n(function(n){u||(u=!0,r(i,n))},function(n){u||(u=!0,t(i,n))})}catch(f){if(u)return;u=!0;t(i,f)}}var s=setTimeout,i;n.prototype["catch"]=function(n){return this.then(null,n)};n.prototype.then=function(n,t){var i=new this.constructor(h);return e(this,new l(n,t,i)),i};n.prototype["finally"]=f;n.all=function(t){return new n(function(n,i){function e(t,u){try{if(u&&(typeof u=="object"||typeof u=="function")){var o=u.then;if(typeof o=="function"){o.call(u,function(n){e(t,n)},i);return}}r[t]=u;--f==0&&n(r)}catch(s){i(s)}}var r,f,u;if(!t||typeof t.length=="undefined")throw new TypeError("Promise.all accepts an array");if(r=Array.prototype.slice.call(t),r.length===0)return n([]);for(f=r.length,u=0;u<r.length;u++)e(u,r[u])})};n.resolve=function(t){return t&&typeof t=="object"&&t.constructor===n?t:new n(function(n){n(t)})};n.reject=function(t){return new n(function(n,i){i(t)})};n.race=function(t){return new n(function(n,i){for(var r=0,u=t.length;r<u;r++)t[r].then(n,i)})};n._immediateFn=typeof setImmediate=="function"&&function(n){setImmediate(n)}||function(n){s(n,0)};n._unhandledRejectionFn=function(n){typeof console!="undefined"&&console&&console.warn("Possible Unhandled Promise Rejection:",n)};i=function(){if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global;throw new Error("unable to locate global object");}();"Promise"in i?i.Promise.prototype["finally"]||(i.Promise.prototype["finally"]=f):i.Promise=n}),function(n){"use strict";function f(n){if(typeof n!="string"&&(n=String(n)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(n))throw new TypeError("Invalid character in header field name");return n.toLowerCase()}function s(n){return typeof n!="string"&&(n=String(n)),n}function e(n){var t={next:function(){var t=n.shift();return{done:t===undefined,value:t}}};return i.iterable&&(t[Symbol.iterator]=function(){return t}),t}function t(n){this.map={};n instanceof t?n.forEach(function(n,t){this.append(t,n)},this):Array.isArray(n)?n.forEach(function(n){this.append(n[0],n[1])},this):n&&Object.getOwnPropertyNames(n).forEach(function(t){this.append(t,n[t])},this)}function o(n){if(n.bodyUsed)return Promise.reject(new TypeError("Already read"));n.bodyUsed=!0}function h(n){return new Promise(function(t,i){n.onload=function(){t(n.result)};n.onerror=function(){i(n.error)}})}function b(n){var t=new FileReader,i=h(t);return t.readAsArrayBuffer(n),i}function k(n){var t=new FileReader,i=h(t);return t.readAsText(n),i}function d(n){for(var i=new Uint8Array(n),r=new Array(i.length),t=0;t<i.length;t++)r[t]=String.fromCharCode(i[t]);return r.join("")}function c(n){if(n.slice)return n.slice(0);var t=new Uint8Array(n.byteLength);return t.set(new Uint8Array(n)),t.buffer}function l(){return this.bodyUsed=!1,this._initBody=function(n){if(this._bodyInit=n,n)if(typeof n=="string")this._bodyText=n;else if(i.blob&&Blob.prototype.isPrototypeOf(n))this._bodyBlob=n;else if(i.formData&&FormData.prototype.isPrototypeOf(n))this._bodyFormData=n;else if(i.searchParams&&URLSearchParams.prototype.isPrototypeOf(n))this._bodyText=n.toString();else if(i.arrayBuffer&&i.blob&&p(n))this._bodyArrayBuffer=c(n.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else if(i.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(n)||w(n)))this._bodyArrayBuffer=c(n);else throw new Error("unsupported BodyInit type");else this._bodyText="";this.headers.get("content-type")||(typeof n=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):i.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},i.blob&&(this.blob=function(){var n=o(this);if(n)return n;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");else return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?o(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(b)}),this.text=function(){var n=o(this);if(n)return n;if(this._bodyBlob)return k(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(d(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");else return Promise.resolve(this._bodyText)},i.formData&&(this.formData=function(){return this.text().then(nt)}),this.json=function(){return this.text().then(JSON.parse)},this}function g(n){var t=n.toUpperCase();return a.indexOf(t)>-1?t:n}function u(n,i){i=i||{};var r=i.body;if(n instanceof u){if(n.bodyUsed)throw new TypeError("Already read");this.url=n.url;this.credentials=n.credentials;i.headers||(this.headers=new t(n.headers));this.method=n.method;this.mode=n.mode;r||n._bodyInit==null||(r=n._bodyInit,n.bodyUsed=!0)}else this.url=String(n);if(this.credentials=i.credentials||this.credentials||"omit",(i.headers||!this.headers)&&(this.headers=new t(i.headers)),this.method=g(i.method||this.method||"GET"),this.mode=i.mode||this.mode||null,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function nt(n){var t=new FormData;return n.trim().split("&").forEach(function(n){if(n){var i=n.split("="),r=i.shift().replace(/\+/g," "),u=i.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(u))}}),t}function tt(n){var i=new t,r=n.replace(/\r?\n[\t ]+/g," ");return r.split(/\r?\n/).forEach(function(n){var t=n.split(":"),r=t.shift().trim(),u;r&&(u=t.join(":").trim(),i.append(r,u))}),i}function r(n,i){i||(i={});this.type="default";this.status=i.status===undefined?200:i.status;this.ok=this.status>=200&&this.status<300;this.statusText="statusText"in i?i.statusText:"OK";this.headers=new t(i.headers);this.url=i.url||"";this._initBody(n)}var i,a,v;if(!n.fetch){if(i={searchParams:"URLSearchParams"in n,iterable:"Symbol"in n&&"iterator"in Symbol,blob:"FileReader"in n&&"Blob"in n&&function(){try{return new Blob,!0}catch(n){return!1}}(),formData:"FormData"in n,arrayBuffer:"ArrayBuffer"in n},i.arrayBuffer)var y=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],p=function(n){return n&&DataView.prototype.isPrototypeOf(n)},w=ArrayBuffer.isView||function(n){return n&&y.indexOf(Object.prototype.toString.call(n))>-1};t.prototype.append=function(n,t){n=f(n);t=s(t);var i=this.map[n];this.map[n]=i?i+","+t:t};t.prototype["delete"]=function(n){delete this.map[f(n)]};t.prototype.get=function(n){return n=f(n),this.has(n)?this.map[n]:null};t.prototype.has=function(n){return this.map.hasOwnProperty(f(n))};t.prototype.set=function(n,t){this.map[f(n)]=s(t)};t.prototype.forEach=function(n,t){for(var i in this.map)this.map.hasOwnProperty(i)&&n.call(t,this.map[i],i,this)};t.prototype.keys=function(){var n=[];return this.forEach(function(t,i){n.push(i)}),e(n)};t.prototype.values=function(){var n=[];return this.forEach(function(t){n.push(t)}),e(n)};t.prototype.entries=function(){var n=[];return this.forEach(function(t,i){n.push([i,t])}),e(n)};i.iterable&&(t.prototype[Symbol.iterator]=t.prototype.entries);a=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];u.prototype.clone=function(){return new u(this,{body:this._bodyInit})};l.call(u.prototype);l.call(r.prototype);r.prototype.clone=function(){return new r(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new t(this.headers),url:this.url})};r.error=function(){var n=new r(null,{status:0,statusText:""});return n.type="error",n};v=[301,302,303,307,308];r.redirect=function(n,t){if(v.indexOf(t)===-1)throw new RangeError("Invalid status code");return new r(null,{status:t,headers:{location:n}})};n.Headers=t;n.Request=u;n.Response=r;n.fetch=function(n,t){return new Promise(function(f,e){var s=new u(n,t),o=new XMLHttpRequest;o.onload=function(){var n={status:o.status,statusText:o.statusText,headers:tt(o.getAllResponseHeaders()||"")},t;n.url="responseURL"in o?o.responseURL:n.headers.get("X-Request-URL");t="response"in o?o.response:o.responseText;f(new r(t,n))};o.onerror=function(){e(new TypeError("Network request failed"))};o.ontimeout=function(){e(new TypeError("Network request failed"))};o.open(s.method,s.url,!0);s.credentials==="include"?o.withCredentials=!0:s.credentials==="omit"&&(o.withCredentials=!1);"responseType"in o&&i.blob&&(o.responseType="blob");s.headers.forEach(function(n,t){o.setRequestHeader(t,n)});o.send(typeof s._bodyInit=="undefined"?null:s._bodyInit)})};n.fetch.polyfill=!0}}(typeof self!="undefined"?self:this),function(n){function t(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("hide");n.classList.remove("show");n.classList.remove("show-inline");n.classList.remove("show-flex")}function i(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show");n.classList.remove("hide");n.classList.remove("show-inline");n.classList.remove("show-flex")}function l(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show-inline");n.classList.remove("hide");n.classList.remove("show");n.classList.remove("show-flex")}function a(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show-flex");n.classList.remove("hide");n.classList.remove("show-inline");n.classList.remove("show")}function e(n,u,f){var e,o,s;typeof n=="string"&&(n=document.getElementById(n));u&&(r(n),e=document.createElement("div"),e.classList.add("notification"),e.classList.add("is-danger"),o=document.createElement("button"),o.classList.add("delete"),o.onclick=function(){t(n)},e.appendChild(o),Array.isArray(u)?(s=document.createElement("ul"),u.forEach(function(n){var t=document.createElement("li");t.appendChild(document.createTextNode(n));s.appendChild(t)}),e.appendChild(s)):e.appendChild(document.createTextNode(u)),n.appendChild(e));i(n);(f==undefined||f===!0)&&window.setTimeout(function(){t(n)},1e4)}function r(n){if(n!==null&&n!==undefined)while(n.firstChild)n.removeChild(n.firstChild)}function v(n,t,i){i===void 0&&(i=!1);var r=document.createElement("option");return r.value=n,r.text=t,r.selected=i,r}function o(n){return typeof n=="string"&&(n=document.getElementById(n)),n.value}function y(n,t){typeof n=="string"&&(n=document.getElementById(n));n.value=t}function u(n,t){typeof n=="string"&&(n=document.getElementById(n));r(n);n.appendChild(document.createTextNode(t))}function s(n){var u=n.replace("nav-",""),r=document.querySelectorAll("#menuTabs > li > a"),t,i;if(r.length>0)for(t=0;t<r.length;t++)i=r.item(t),i.id===n?i.parentElement.classList.add("is-active"):i.parentElement.classList.remove("is-active");f("#views > section",u)}function p(n,t,i){h(n,"nav-"+i);f(t,i)}function h(n,t){var u=document.querySelectorAll(n),i,r;if(u.length>0)for(i=0;i<u.length;i++)r=u.item(i),r.id===t?r.classList.add("is-active"):r.classList.remove("is-active")}function f(n,r){var e=document.querySelectorAll(n),u,f;if(e.length>0)for(u=0;u<e.length;u++)f=e.item(u),f.id===r?i(f):t(f)}function w(n){return fetch(n,{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-cache",credentials:"include"}).then(function(n){if(!n.ok)throw new Error(n.statusText);return n.json()})}function b(n,t){return fetch(n,{method:"POST",body:JSON.stringify(t),cache:"no-cache",headers:{"Content-Type":"application/json"},credentials:"include"}).then(function(n){if(console.log("Post Response",n),!n.ok)throw new Error(n.statusText);return n.json()})}function k(n,t){return fetch(n,{method:"POST",body:t!==null?JSON.stringify(t):"",cache:"no-cache",headers:{"Content-Type":"application/json"},credentials:"include"}).then(function(n){return n})}function d(n){return n.toLocaleString("en-US",{style:"currency",currency:"USD"})}function g(n){return n instanceof Date?n.toLocaleDateString("en-us"):new Date(n).toLocaleDateString("en-US")}function nt(n,t,i){var r,u;return(typeof n=="string"&&(n=document.getElementById(n)),r=n,r.tagName.toLowerCase()==="select"?r.parentElement.classList.remove("is-danger"):r.classList.remove("is-danger"),u=o(r).trim(),u.length==0)?(r.tagName.toLowerCase()==="select"?r.parentElement.classList.add("is-danger"):r.classList.add("is-danger"),e(t,i),r.focus(),r.scrollTo(),""):u}function tt(n,t){typeof n=="string"&&(n=document.getElementById(n));var i=n;i.disabled=t;i.classList.toggle("is-loading",t)}function it(n){var u=document.createElement("li"),t,i,f,o,r,e,s;if(n.selected&&u.classList.add("is-active"),t=document.createElement("a"),t.id=n.id,t.onclick=function(){c(n)},n.icon.length>0){for(i=document.createElement("span"),i.classList.add("icon"),i.classList.add("is-medium"),f=document.createElement("i"),o=n.icon.split(" "),r=0,e=o;r<e.length;r++)s=e[r],f.classList.add(s);i.appendChild(f);t.appendChild(i)}return t.appendChild(document.createTextNode(n.label)),u.appendChild(t),u}function c(n){u("menuTitle",n.title);u("menuSubTitle",n.subTitle);s(n.id);document.getElementById(n.autofocusId).focus()}function rt(t,i){for(var f,e=document.getElementById(t),r=0,u=i;r<u.length;r++)f=u[r],e.appendChild(n.Create_Menu_Element(f))}function ut(){return(navigator.userAgent.indexOf("Opera")||navigator.userAgent.indexOf("OPR"))!=-1?"Opera":navigator.userAgent.indexOf("Chrome")!=-1?"Chrome":navigator.userAgent.indexOf("Safari")!=-1?"Safari":navigator.userAgent.indexOf("Firefox")!=-1?"Firefox":navigator.userAgent.indexOf("MSIE")!=-1||!!document.DOCUMENT_NODE==!0?"IE":"unknown"}function ft(n){var t="/",i=window.location.pathname.toLowerCase().indexOf(n);return i==0&&(t=n+"/"),t}n.Hide=t;n.Show=i;n.Show_Inline=l;n.Show_Flex=a;n.Error_Show=e;n.Clear_Element=r;n.Create_Option=v;n.Get_Value=o;n.Set_Value=y;n.Set_Text=u;n.Show_Menu=s;n.Handle_Tabs=p;n.Activate_Inactivate_Selector=h;n.Show_Hide_Selector=f;n.Get=w;n.Post=b;n.Post_Empty=k;n.Format_Amount=d;n.Format_Date=g;n.Validate_Text=nt;n.Toggle_Loading_Button=tt;n.Create_Menu_Element=it;n.Update_Menu=c;n.Build_Menu_Elements=rt;n.CheckBrowser=ut;n.Get_Path=ft}(Utilities||(Utilities={})),function(n){var t=function(){function t(t){this.mapDiv=t;this.isDrawing=!1;var i=this;require(["esri/map","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/GraphicsLayer","esri/dijit/Legend","dojo/_base/array","dojo/parser","dijit/layout/BorderContainer","esri/toolbars/draw","dojo/domReady!"],function(r,u,f){var e,o;i.map=new r(t,{basemap:"osm",zoom:11,logo:!1,center:[-81.8,29.95]});i.map.infoWindow.resize(600,100);i.map.on("load",function(){n.mapLoadCompleted()});e={opacity:.3};o=new u("https://maps.claycountygov.com:6443/arcgis/rest/services/Building/MapServer",e);n.location_layer=new f;n.location_layer.id="locations";n.unit_layer=new f;n.unit_layer.id="units";i.map.addLayers([o,n.location_layer,n.unit_layer])})}return t.prototype.ToggleDraw=function(n){n===void 0&&(n=null);var t=this;require(["esri/toolbars/draw"],function(i){t.isDrawing=n!==null?n:!t.isDrawing;t.isDrawing?t.drawToolbar.activate(i.EXTENT):t.drawToolbar.deactivate()})},t.prototype.UpdateLocationLayer=function(t){require(["esri/layers/GraphicsLayer","esri/geometry/Point","esri/symbols/SimpleMarkerSymbol","esri/graphic","esri/SpatialReference","esri/Color","esri/InfoTemplate","esri/geometry/webMercatorUtils","esri/symbols/TextSymbol"],function(i,r,u,f,e,o,s,h,c){var k,d,y,v,l,a,p,g,w,b,nt;for(n.location_layer.clear(),k=function(t){var u=t.point_to_use,i;if(d=new r([u.Longitude,u.Latitude],new e({wkid:4326})),y=h.geographicToWebMercator(d),v=new s,v.setTitle("Inspections: "+t.inspections.length.toString()),v.setContent(function(){var n=t.LocationView().outerHTML;return console.log("html info template",n),n}),t.icons.length>1)for(i=0;i<t.icons.length;i++)l=new f(y,t.icons[i]),l.setInfoTemplate(v),n.location_layer.add(l);else l=new f(y,t.icons[0]),l.setInfoTemplate(v),n.location_layer.add(l);t.inspections.length>1&&(a=new c(t.inspections.length.toString()),a.setColor(new dojo.Color([0,100,0])),a.setOffset(0,-20),a.setAlign(c.ALIGN_MIDDLE),p=new esri.symbol.Font,p.setSize("8pt"),p.setWeight(esri.symbol.Font.WEIGHT_BOLD),a.setFont(p),g=new f(y,a),n.location_layer.add(g))},w=0,b=t;w<b.length;w++)nt=b[w],k(nt);n.location_layer.show()})},t.prototype.CreateLayers=function(n,t,i){if(n.length===0)return[];var r;return require(["esri/layers/GraphicsLayer","esri/geometry/Point","esri/symbols/SimpleMarkerSymbol","esri/graphic","esri/SpatialReference","esri/Color","esri/InfoTemplate","esri/geometry/webMercatorUtils"],function(u,f,e,o,s,h,c,l){r=n.map(function(n){var r=new u,v,a;return r.id=n.Name+"-"+t+"-"+i,r.inspector=n.Id,r.completed=i,r.day=t,r.color=n.Color,r.numberInspections=n.Inspections.length,v=h.fromHex(n.Color),a=n.Inspections.map(function(n){return n.LookupKey}),a=a.filter(function(n,t){return a.indexOf(n)==t}),a.forEach(function(t){var i=n.Inspections.filter(function(n){return n.LookupKey==t}),u=i[0].PointToUse,y=i[0].StreetAddressCombined+"<br/> "+i[0].City+", "+i[0].Zip,h;if(u.IsValid||console.log("Invalid data",t,n),u.IsValid){h=new c;h.setTitle("Address: ${CompactAddress}");var p=new e({color:v,size:12,angle:0,xoffset:0,yoffset:-5,type:"esriSMS",style:"esriSMSCircle",outline:{color:[0,0,0,255],width:1,type:"esriSLS",style:"esriSLSSolid"}}),w=new f([u.Longitude,u.Latitude],new s({wkid:4326})),b=l.geographicToWebMercator(w),a=new o(b,p);a.setAttributes({CompactAddress:y,LookupKey:t});a.setInfoTemplate(h);r.add(a)}}),r})}),r},t.prototype.ApplyLayers=function(n){var t=this;this.map.addLayers(n)},t.prototype.ToggleLayers=function(n,t,i,r){var u=this.map;this.map.graphicsLayerIds.forEach(function(f){var e=u.getLayer(f);e.inspector===n&&e.day===t&&e.completed===i&&(r?e.show():e.hide())})},t.prototype.ToggleLayersByDay=function(n,t){var i=this.map;i.graphicsLayerIds.forEach(function(r){var u=i.getLayer(r);u.day===n&&u.completed===t?u.show():u.hide()})},t.prototype.ClearLayers=function(){var n=this.map,t,i,r;if(n.graphicsLayerIds)while(n.graphicsLayerIds.length>0)for(t=0,i=n.graphicsLayerIds;t<i.length;t++)r=i[t],n.removeLayer(n.getLayer(r))},t.prototype.FindItemsInExtent=function(n){var t=this,i=this.map,r=[];return require(["esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/Color"],function(t){i.graphicsLayerIds.forEach(function(u){var h=i.getLayer(u),o,s,f,e;if(h.visible)for(o=0,s=h.graphics;o<s.length;o++)f=s[o],n.contains(f.geometry)&&(e=new t,e.color=f.symbol.color,e.size=f.symbol.size,e.style=t.STYLE_SQUARE,e.outline=f.symbol.outline,f.setSymbol(e),r.push(f.attributes.LookupKey))})}),t.isDrawing=!1,t.drawToolbar.deactivate(),r},t.prototype.CenterAndZoom=function(n){var i=this,t=this.map;require(["esri/geometry/Point"],function(i){var r=new i([n.Longitude,n.Latitude]);t.centerAndZoom(r,18)})},t}();n.MapController=t}(IView||(IView={})),function(n){var t=function(){function t(t){if(this.lookup_key="",this.point_to_use=null,this.icons=[],this.valid_inspectors=[],this.inspections=[],this.all_inspections=[],this.has_commercial=!1,this.has_residential=!1,this.has_private_provider=!1,this.can_be_bulk_assigned=!0,this.assigned_inspectors=[],this.RBL=!1,this.CBL=!1,this.REL=!1,this.CEL=!1,this.RME=!1,this.CME=!1,this.RPL=!1,this.CPL=!1,this.Fire=!1,this.inspections=t,t.length!==0){var i=t[0];this.lookup_key=i.LookupKey;this.point_to_use=i.PointToUse;this.UpdateFlags();this.CreateIcons();this.AddValidInspectors(n.allInspectors)}}return t.prototype.UpdateFlags=function(){var t,i,n;for(this.assigned_inspectors=[],t=0,i=this.inspections;t<i.length;t++)n=i[t],n.CanBeAssigned||(this.can_be_bulk_assigned=!1),n.IsCommercial?this.has_commercial=!0:this.has_residential=!0,n.IsPrivateProvider&&(this.has_private_provider=!0),this.assigned_inspectors.indexOf(n.InspectorName)===-1&&(this.assigned_inspectors.push(n.InspectorName),this[n.InspectorName]={commercial:0,residential:0,hexcolor:n.Color}),n.IsCommercial?this[n.InspectorName].commercial+=1:this[n.InspectorName].residential+=1,n.RBL&&(this.RBL=!0),n.CBL&&(this.CBL=!0),n.REL&&(this.REL=!0),n.CEL&&(this.CEL=!0),n.RME&&(this.RME=!0),n.CME&&(this.CME=!0),n.RPL&&(this.RPL=!0),n.CPL&&(this.CPL=!0),n.Fire&&(this.Fire=!0)},t.prototype.AddValidInspectors=function(n){if(this.can_be_bulk_assigned){var t=this;this.valid_inspectors=n.filter(function(n){return(t.RBL===n.RBL==!0||!t.RBL)&&(t.CBL===n.CBL==!0||!t.CBL)&&(t.REL===n.REL==!0||!t.REL)&&(t.CEL===n.CEL==!0||!t.CEL)&&(t.RME===n.RME==!0||!t.RME)&&(t.CME===n.CME==!0||!t.CME)&&(t.RPL===n.RPL==!0||!t.RPL)&&(t.CPL===n.CPL==!0||!t.CPL)&&(t.Fire===n.Fire==!0||!t.Fire)});this.valid_inspectors.length===0&&(this.can_be_bulk_assigned=!1)}},t.prototype.CreateIcons=function(){var i=0,t,r,e,u;this.assigned_inspectors.length>1&&(i=1);var f=this.GetOffsets(),o=function(t){var r,u,e;if(i>f.length)return{value:void 0};r="";r=n[t].commercial>0&&n[t].residential>0?"esriSMSDiamond":n[t].commercial>0?"esriSMSSquare":"esriSMSCircle";u=n.CreateIcon(r,n[t].hexcolor,f[i++]);e=n;u.then(function(n){e.icons.push(n)})},n=this;for(t=0,r=this.assigned_inspectors;t<r.length;t++)if(e=r[t],u=o(e),typeof u=="object")return u.value},t.prototype.CreateIcon=function(n,t,i){var r=new dojo.Deferred;return require(["esri/symbols/SimpleMarkerSymbol","esri/Color"],function(u,f){var e=new u({color:f.fromHex(t),size:12,angle:0,xoffset:i[0],yoffset:i[1],type:"esriSMS",style:n,outline:{color:[0,0,0,255],width:1,type:"esriSLS",style:"esriSLSSolid"}});r.resolve(e)}),r},t.prototype.GetOffsets=function(){return[[0,0],[-5,5],[5,-5],[-5,-5],[5,5],[-5,0],[0,5],[5,0],[0,5]]},t.CreateLocations=function(i){var l=i.length.toString(),r,u,e,o,h,f,s,c;for(Utilities.Set_Text(document.getElementById("inspectionCount"),l),r=[],n.filteredLocations=[],u=0,e=i;u<e.length;u++)o=e[u],r.indexOf(o.LookupKey)===-1&&r.push(o.LookupKey);for(h=function(r){var u=i.filter(function(n){return n.LookupKey===r});n.filteredLocations.push(new t(u))},f=0,s=r;f<s.length;f++)c=s[f],h(c);console.log("locations",n.filteredLocations);console.log("inspectors > 1",n.filteredLocations.filter(function(n){return n.icons.length>2}));console.log("inspections > 2",n.filteredLocations.filter(function(n){return n.inspections.length>2}));console.log("mixed inspections",n.filteredLocations.filter(function(n){return n.has_commercial&&n.has_residential}));n.dataLoaded=!0;n.BuildAndLoadInitialLayers()},t.prototype.LocationView=function(){var t=document.createElement("div"),n=document.createDocumentFragment();return n.appendChild(this.AddressView()),n.appendChild(this.BulkAssignControl()),n.appendChild(this.CreateInspectionTable()),t.appendChild(n),t},t.prototype.AddressView=function(){var n=this.inspections[0],t=document.createElement("p");return t.appendChild(document.createTextNode(n.StreetAddressCombined)),t.appendChild(document.createTextNode(n.City+", "+n.Zip)),t},t.prototype.BulkAssignControl=function(){var n=document.createElement("div");return n.appendChild,n},t.prototype.CreateInspectionTable=function(){var n=document.createElement("table"),i,t,r,u;for(n.classList.add("table"),n.classList.add("is-fullwidth"),n.appendChild(this.CreateInspectionTableHeading()),i=document.createElement("tbody"),t=0,r=this.inspections;t<r.length;t++)u=r[t],i.appendChild(this.CreateInspectionRow(u));return n.appendChild(i),n},t.prototype.CreateInspectionTableHeading=function(){var t=document.createElement("thead"),n=document.createElement("tr");return n.appendChild(this.CreateTableCell(!0,"Permit")),n.appendChild(this.CreateTableCell(!0,"Inspection Type")),n.appendChild(this.CreateTableCell(!0,"Kind")),n.appendChild(this.CreateTableCell(!0,"Private Provider")),n.appendChild(this.CreateTableCell(!0,"Status")),n.appendChild(this.CreateTableCell(!0,"Assigned")),t.appendChild(n),t},t.prototype.CreateTableCell=function(n,t,i){i===void 0&&(i="");var r=document.createElement(n?"th":"td");return i.length>0&&r.classList.add(i),r.appendChild(document.createTextNode(t)),r},t.prototype.CreateInspectionRow=function(n){var t=document.createElement("tr");return t.appendChild(this.CreateTableCell(!1,n.PermitNo)),t.appendChild(this.CreateTableCell(!1,n.InspectionCode+" "+n.InspectionDescription)),t.appendChild(this.CreateTableCell(!1,n.IsCommercial?"Commercial":"Residential")),t.appendChild(this.CreateTableCell(!1,n.IsPrivateProvider?"Yes":"No")),t.appendChild(this.CreateTableCell(!1,n.IsCompleted?"Completed":"Incomplete")),t.appendChild(this.CreateTableCell(!1,n.InspectorName)),t},t}();n.Location=t}(IView||(IView={})),function(n){var t=function(){function n(n){var i,t,r;for(this.InspectionId=0,i=n.split("&"),t=0;t<i.length;t++){r=i[t].split("=");switch(r[0].toLowerCase()){case"inspectionid":this.InspectionId=parseInt(r[1])}}}return n.prototype.ToHash=function(){var n="";return this.InspectionId>0&&(n+="&inspectionid="+this.InspectionId.toString()),n.length>0&&(n="#"+n.substring(1)),n},n}();n.LocationHash=t}(IView||(IView={})),function(n){var t=function(){function t(){}return t.GetAllInspectors=function(){Utilities.Toggle_Loading_Button("refreshButton",!0);Utilities.Toggle_Loading_Button("filterButton",!0);var i=Utilities.Get_Path("/inspectionview");Utilities.Get(i+"API/Inspectors/List").then(function(i){console.log("inspectors",i);n.allInspectors=i;n.Inspection.GetInspections();window.setInterval(n.Inspection.GetInspections,3e5);window.setInterval(n.Unit.GetUnits,6e4);t.BuildInspectorList()},function(){console.log("error getting inspectors");n.allInspectors=[]})},t.GetInspectorsToEdit=function(){var t=Utilities.Get_Path("/inspectionview");Utilities.Get(t+"API/Inspectors/Edit").then(function(t){console.log("inspectors to edit",t);n.inspectors_to_edit=t},function(){console.log("error getting inspectors");n.allInspectors=[]})},t.BuildInspectorList=function(){var r=document.getElementById("inspectorList"),i,u,f;for(Utilities.Clear_Element(r),r.appendChild(t.AddInspector("All")),i=0,u=n.allInspectors;i<u.length;i++)f=u[i],r.appendChild(t.AddInspector(f.Name));n.FilterInputEvents()},t.AddInspector=function(n){var r=document.createDocumentFragment(),i=document.createElement("label"),t;return i.classList.add("label"),i.classList.add("checkbox"),i.classList.add("is-medium"),t=document.createElement("input"),t.type="checkbox",t.classList.add("checkbox"),t.classList.add("is-medium"),t.name="inspectorFilter",t.value=n,t.checked=n==="All",i.appendChild(t),i.appendChild(document.createTextNode(n)),r.appendChild(i),r},t.BuildInspectorControl=function(){},t}();n.Inspector=t}(IView||(IView={})),function(n){var t=function(){function t(){this.Age=-1;this.ValidInspectors=[]}return t.GetInspections=function(){Utilities.Toggle_Loading_Button("refreshButton",!0);Utilities.Toggle_Loading_Button("filterButton",!0);var t=Utilities.Get_Path("/inspectionview");Utilities.Get(t+"API/Inspections/GetInspections").then(function(t){n.allInspections=t;Utilities.Toggle_Loading_Button("refreshButton",!1);Utilities.Toggle_Loading_Button("filterButton",!1);n.Location.CreateLocations(n.ApplyFilters(t));n.Inspector.GetInspectorsToEdit()},function(t){console.log("error getting inspectors",t);n.allInspectors=[];Utilities.Toggle_Loading_Button("refreshButton",!1);Utilities.Toggle_Loading_Button("filterButton",!1)})},t}();n.Inspection=t}(IView||(IView={})),function(n){function o(){n.mapController=new n.MapController("map");n.Inspector.GetAllInspectors()}function s(){n.day_filter="today";n.inspection_status_filter="open";n.permit_kind_filter="all";n.permit_type_filter=[];n.inspector_filter=[];n.private_provider_only=!1;n.invalid_address_only=!1;document.querySelector("input[name='inspectionStatus'][value='open']").checked=!0;document.querySelector("input[name='inspectionDay'][value='today']").checked=!0;document.querySelector("input[name='commercialResidential'][value='all']").checked=!0;document.getElementById("privateProviderFilter").checked=!1;document.getElementById("invalidAddressFilter").checked=!1;t("input[name='inspectorFilter']",!1);document.querySelector("input[name='inspectorFilter'][value='All']").checked=!0;t("input[name='permitType']",!1);document.querySelector("input[name='permitType'][value='all']").checked=!0;n.Location.CreateLocations(i(n.allInspections))}function h(r){r==="inspectors"?(n.inspector_toggle_status=!n.inspector_toggle_status,t("input[name='inspectorFilter']",n.inspector_toggle_status)):(n.permit_types_toggle_status=!n.permit_types_toggle_status,t("input[name='permitType']",n.permit_types_toggle_status));n.Location.CreateLocations(i(n.allInspections))}function t(n,t){for(var r=document.querySelectorAll(n),i=0;i<r.length;i++)r.item(i).checked=t}function c(){for(var r=document.querySelectorAll("#filters input"),t=0;t<r.length;t++)r.item(t).addEventListener("click",function(){n.Location.CreateLocations(i(n.allInspections))})}function l(){n.inspection_status_filter=r('input[name="inspectionStatus"]:checked');n.day_filter=r('input[name="inspectionDay"]:checked');n.permit_kind_filter=r('input[name="commercialResidential"]:checked');n.private_provider_only=document.getElementById("privateProviderFilter").checked;n.invalid_address_only=document.getElementById("invalidAddressFilter").checked;n.permit_type_filter=f('input[name="permitType"]:checked');n.inspector_filter=f('input[name="inspectorFilter"]:checked')}function i(t){var i,r,u;return l(),i=t,n.inspection_status_filter!=="all"&&(r=n.inspection_status_filter!=="open",i=n.allInspections.filter(function(n){return n.IsCompleted===r})),n.day_filter!=="all"&&(i=n.day_filter!=="prior"?i.filter(function(t){return t.ScheduledDay===n.day_filter}):i.filter(function(n){return n.Age>0})),n.permit_kind_filter!=="all"&&(u=n.permit_kind_filter==="commercial",i=i.filter(function(n){return n.IsCommercial===u})),n.permit_type_filter.indexOf("all")===-1&&(i=i.filter(function(t){return n.permit_type_filter.indexOf(t.PermitNo.substr(0,1))!==-1})),n.private_provider_only&&(i=i.filter(function(n){return n.IsPrivateProvider})),n.invalid_address_only&&(i=i.filter(function(n){return!n.AddressPoint.IsValid||!n.ParcelPoint.IsValid})),n.inspector_filter.indexOf("All")===-1&&(i=i.filter(function(t){return n.inspector_filter.indexOf(t.InspectorName)!==-1})),i}function r(n){return document.querySelector(n).value}function f(n){for(var i=document.querySelectorAll(n),r=[],t=0;t<i.length;t++)r.push(i.item(t).value);return r}function u(){var u=location.hash,i=new n.LocationHash(location.hash.substring(1)),t,r;i.InspectionId>0&&(t=n.allInspections.filter(function(n){return n.InspReqID===i.InspectionId}),t.length>0&&(console.log("inspection based on passed id",t,"inspection point to use",t[0].PointToUse),n.mapController.CenterAndZoom(t[0].PointToUse),r=n.allInspections.filter(function(n){return n.PointToUse.Latitude===t[0].PointToUse.Latitude}),console.log("all points",r)))}function a(){n.mapLoaded=!0;console.log("map load completed");e()}function e(){n.mapLoaded&&n.dataLoaded&&(window.onhashchange=u,u(),n.mapController.UpdateLocationLayer(n.filteredLocations))}function v(){document.getElementById("filters").classList.add("is-active")}function y(){var t=document.querySelectorAll(".modal"),n,i;if(t.length>0)for(n=0;n<t.length;n++)i=t.item(n),i.classList.remove("is-active")}n.allInspections=[];n.inspectors_to_edit=[];n.allInspectors=[];n.allUnits=[];n.filteredLocations=[];n.day_filter="today";n.inspection_status_filter="open";n.permit_kind_filter="all";n.permit_type_filter=[];n.inspector_filter=[];n.private_provider_only=!1;n.invalid_address_only=!1;n.permit_types_toggle_status=!1;n.inspector_toggle_status=!1;n.mapLoaded=!1;n.dataLoaded=!1;n.Start=o;n.ResetFilters=s;n.Toggle_Group=h;n.FilterInputEvents=c;n.ApplyFilters=i;n.HandleHash=u;n.mapLoadCompleted=a;n.BuildAndLoadInitialLayers=e;n.ShowFilters=v;n.CloseModals=y}(IView||(IView={}));